<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Trader Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f1419;
            color: #e0e0e0;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #fff; margin-bottom: 20px; font-size: 28px; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1f26;
            border-radius: 10px;
        }
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .status-running { background: #10b981; color: white; }
        .status-stopped { background: #ef4444; color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card {
            background: #1a1f26;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .card h3 { color: #fff; margin-bottom: 15px; font-size: 16px; }
        .metric { margin-bottom: 10px; }
        .metric-label { color: #9ca3af; font-size: 13px; }
        .metric-value { color: #fff; font-size: 24px; font-weight: bold; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .table-container { background: #1a1f26; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #2d3748; color: #fff; padding: 12px; text-align: left; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #2d3748; font-size: 13px; }
        tr:hover { background: #2d3748; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .btn-refresh { background: #3b82f6; color: white; }
        .btn-refresh:hover { background: #2563eb; }
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üéØ Pro Trader Dashboard</h1>
                <p style="color: #9ca3af;">Real-time Trading System Monitor</p>
            </div>
            <div>
                <span id="systemStatus" class="status-badge status-stopped">‚ö´ Stopped</span>
                <button class="btn btn-refresh" onclick="refreshData()">üîÑ Refresh</button>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>üìä Total Trades</h3>
                <div class="metric">
                    <div class="metric-value" id="totalTrades">-</div>
                    <div class="metric-label">All time</div>
                </div>
            </div>
            <div class="card">
                <h3>‚úÖ Win Rate</h3>
                <div class="metric">
                    <div class="metric-value" id="winRate">-</div>
                    <div class="metric-label">Success rate</div>
                </div>
            </div>
            <div class="card">
                <h3>üí∞ Total P&L</h3>
                <div class="metric">
                    <div class="metric-value" id="totalPnl">-</div>
                    <div class="metric-label">Cumulative</div>
                </div>
            </div>
            <div class="card">
                <h3>üìà Profit Factor</h3>
                <div class="metric">
                    <div class="metric-value" id="profitFactor">-</div>
                    <div class="metric-label">Risk/Reward ratio</div>
                </div>
            </div>
        </div>

        <div class="table-container">
            <h3 style="color: #fff; margin-bottom: 15px;">üìç Active Positions</h3>
            <div id="activePositions">Loading...</div>
        </div>

        <div class="table-container">
            <h3 style="color: #fff; margin-bottom: 15px;">üìã Recent Trades</h3>
            <div id="recentTrades">Loading...</div>
        </div>
    </div>

    <script>
        function formatNumber(num, decimals = 2) {
            return parseFloat(num).toFixed(decimals);
        }

        function formatPercent(num) {
            const val = parseFloat(num);
            const sign = val >= 0 ? '+' : '';
            const color = val >= 0 ? 'positive' : 'negative';
            return `<span class="${color}">${sign}${val.toFixed(2)}%</span>`;
        }

        async function refreshData() {
            try {
                // Fetch status
                const statusRes = await fetch('/api/status');
                const status = await statusRes.json();

                if (status.success) {
                    const stats = status.statistics;
                    document.getElementById('totalTrades').textContent = stats.total_trades;
                    document.getElementById('winRate').innerHTML = formatPercent(stats.win_rate);
                    document.getElementById('totalPnl').innerHTML = formatPercent(stats.total_pnl);
                    document.getElementById('profitFactor').textContent = formatNumber(stats.profit_factor);

                    // Update system status
                    const statusBadge = document.getElementById('systemStatus');
                    if (status.system.is_running) {
                        statusBadge.className = 'status-badge status-running';
                        statusBadge.innerHTML = '<span class="live-indicator"></span>Running - ' + status.system.mode;
                    } else {
                        statusBadge.className = 'status-badge status-stopped';
                        statusBadge.textContent = '‚ö´ Stopped';
                    }
                }

                // Fetch positions
                const posRes = await fetch('/api/positions');
                const posData = await posRes.json();

                if (posData.success) {
                    const positions = posData.positions;
                    let posHtml = '';

                    if (positions.length === 0) {
                        posHtml = '<p style="color: #9ca3af;">No active positions</p>';
                    } else {
                        posHtml = '<table><thead><tr><th>Symbol</th><th>Type</th><th>Entry</th><th>Quantity</th><th>Stop Loss</th><th>TP1</th><th>TP2</th><th>Time</th></tr></thead><tbody>';
                        positions.forEach(pos => {
                            posHtml += `<tr>
                                <td><strong>${pos.symbol}</strong></td>
                                <td><span class="${pos.type === 'LONG' ? 'positive' : 'negative'}">${pos.type}</span></td>
                                <td>$${formatNumber(pos.entry_price, 4)}</td>
                                <td>${formatNumber(pos.quantity, 6)}</td>
                                <td>$${formatNumber(pos.stop_loss, 4)}</td>
                                <td>$${formatNumber(pos.take_profit_1, 4)}</td>
                                <td>$${formatNumber(pos.take_profit_2, 4)}</td>
                                <td>${new Date(pos.entry_time).toLocaleString()}</td>
                            </tr>`;
                        });
                        posHtml += '</tbody></table>';
                    }
                    document.getElementById('activePositions').innerHTML = posHtml;
                }

                // Fetch trades
                const tradesRes = await fetch('/api/trades?limit=20');
                const tradesData = await tradesRes.json();

                if (tradesData.success) {
                    const trades = tradesData.trades;
                    let tradesHtml = '<table><thead><tr><th>Symbol</th><th>Type</th><th>Entry</th><th>Exit</th><th>P&L %</th><th>P&L $</th><th>Reason</th><th>Exit Time</th></tr></thead><tbody>';

                    trades.forEach(trade => {
                        tradesHtml += `<tr>
                            <td><strong>${trade.symbol}</strong></td>
                            <td><span class="${trade.type === 'LONG' ? 'positive' : 'negative'}">${trade.type}</span></td>
                            <td>$${formatNumber(trade.entry_price, 4)}</td>
                            <td>$${formatNumber(trade.exit_price, 4)}</td>
                            <td>${formatPercent(trade.pnl_percent)}</td>
                            <td class="${trade.pnl_amount >= 0 ? 'positive' : 'negative'}">$${formatNumber(trade.pnl_amount)}</td>
                            <td>${trade.exit_reason}</td>
                            <td>${new Date(trade.exit_time).toLocaleString()}</td>
                        </tr>`;
                    });
                    tradesHtml += '</tbody></table>';
                    document.getElementById('recentTrades').innerHTML = tradesHtml;
                }

            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }

        // Initial load
        refreshData();

        // Auto-refresh every 5 seconds
        setInterval(refreshData, 5000);
    </script>
</body>
</html>